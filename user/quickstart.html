<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting started with GerryChain &mdash; GerryChain  documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Running a chain with ReCom" href="recom.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0099cd" >
            <a href="../index.html" class="icon icon-home"> GerryChain
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Overview of the Chain</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started with GerryChain</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-you-ll-need">What you’ll need</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-the-initial-partition">Creating the initial partition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-chain">Running a chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#working-with-elections">Working With Elections</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-dataframes-to-collect-information">Using DataFrames to Collect Information</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="recom.html">Running a chain with ReCom</a></li>
<li class="toctree-l1"><a class="reference internal" href="partitions.html">Working with Partitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="updaters.html">Updaters</a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html">Good Data Practices</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometries.html">Working With Geometries</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimizers.html">Optimization Methods of GerryChain</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometric_optimizers.html">Advanced Example: Optimizing Using Geographic Quantities</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/reproducibility.html">Reproducibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/tools.html">Evaluating districting plans in the real world</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/contributing.html">Contributing to GerryChain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/reporting.html">Reporting Issues</a></li>
</ul>
<p class="caption"><span class="caption-text">Index</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../full_ref.html">Full Package Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #0099cd" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GerryChain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting started with GerryChain</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/user/quickstart.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="getting-started-with-gerrychain">
<span id="quickstart"></span><h1>Getting started with GerryChain<a class="headerlink" href="#getting-started-with-gerrychain" title="Permalink to this headline">¶</a></h1>
<p>This guide will show you how to start generating ensembles with GerryChain.</p>
<div class="section" id="what-you-ll-need">
<h2>What you’ll need<a class="headerlink" href="#what-you-ll-need" title="Permalink to this headline">¶</a></h2>
<p>Before we can start running Markov chains, you’ll need to:</p>
<ul class="simple">
<li><p>Install <code class="docutils literal notranslate"><span class="pre">gerrychain</span></code> from PyPI. See the <a class="reference internal" href="install.html"><span class="doc">installation guide</span></a> for instructions.</p></li>
<li><p>Download <a class="reference external" href="https://github.com/mggg/GerryChain/tree/main/docs/_static/PA_VTDs.json">this example json of Pennsylvania’s VTDs</a>.</p></li>
<li><p>Open your preferred Python environment (e.g. JupyterLab, IPython, or a <code class="docutils literal notranslate"><span class="pre">.py</span></code> file
in your favorite editor) in the directory containing the <code class="docutils literal notranslate"><span class="pre">PA_VTDs.json</span></code> file
that you downloaded.</p></li>
</ul>
<p>Throughout this guide, we will assume that the user is working with a jupyter notebook
or a python script file (a *.py file). We will also assume that the end user is working
through this guide is familiar with, but still relatively new to Python.</p>
<p>Also please note that, while this guide makes use of the “propose_random_flip” proposal
function, this is not the only proposal function available in GerryChain (in fact, it is
the one that we use the least). We are only using it here because it provides for
a simple example of how to run a Markov chain.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are having any trouble getting the materials on this tutorial to work, please
consult the <a class="reference internal" href="install.html"><span class="doc">installation guide</span></a> first, and then, if you’re still having
issues, feel free to send us a message at code[at]mggg[dot]org.</p>
</div>
</div>
<div class="section" id="creating-the-initial-partition">
<h2>Creating the initial partition<a class="headerlink" href="#creating-the-initial-partition" title="Permalink to this headline">¶</a></h2>
<div class="center-container">
  <a href="https://github.com/mggg/GerryChain/tree/main/docs/_static/PA_VTDs.json" class="download-badge" download>Download PA File</a>
</div>
<br style="line-height: 5px;"><p>In order to run a Markov chain, we need an
adjacency <code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> of our VTD geometries and
<code class="xref py py-class docutils literal notranslate"><span class="pre">Partition</span></code> of our adjacency graph into districts. This Partition
will be the initial state of our Markov chain.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerrychain</span> <span class="kn">import</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">Partition</span>
<span class="kn">from</span> <span class="nn">gerrychain.updaters</span> <span class="kn">import</span> <span class="n">Tally</span><span class="p">,</span> <span class="n">cut_edges</span>


<span class="c1"># Load the graph in from the provided json file</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">Graph</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s2">&quot;./PA_VTDs.json&quot;</span><span class="p">)</span>

<span class="c1"># Set up the initial partition object</span>
<span class="n">initial_partition</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">assignment</span><span class="o">=</span><span class="s2">&quot;2011_PLA_1&quot;</span><span class="p">,</span>
    <span class="n">updaters</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;population&quot;</span><span class="p">:</span> <span class="n">Tally</span><span class="p">(</span><span class="s2">&quot;TOT_POP&quot;</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">),</span>
        <span class="s2">&quot;cut_edges&quot;</span><span class="p">:</span> <span class="n">cut_edges</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here’s what’s happening in this code block.</p>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">Graph.from_json()</span></code> classmethod creates a
<code class="xref py py-class docutils literal notranslate"><span class="pre">Graph</span></code> of the precincts. By default, this method
copies all of the data columns from the shapefile’s attribute table to the <code class="docutils literal notranslate"><span class="pre">graph</span></code> object
as node attributes. The contents of this particular shapefile’s attribute table are
summarized in the <a class="reference external" href="https://github.com/mggg-states/PA-shapefiles#metadata">mggg-states/PA-shapefiles</a>
GitHub repo.</p>
<p>Then, we create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Partition</span></code> of the graph.
This will be the starting point for our Markov chain. The <code class="xref py py-class docutils literal notranslate"><span class="pre">Partition</span></code> class
takes three arguments:</p>
<dl class="field-list simple">
<dt class="field-odd">graph</dt>
<dd class="field-odd"><p>A graph.</p>
</dd>
<dt class="field-even">assignment</dt>
<dd class="field-even"><p>An assignment of the nodes of the graph into parts of the partition. This can be either
a dictionary mapping node IDs to part IDs, or the string key of a node attribute that holds
each node’s assignment. In this example we’ve written <code class="docutils literal notranslate"><span class="pre">assignment=&quot;2011_PLA_1&quot;</span></code> to tell the <code class="xref py py-class docutils literal notranslate"><span class="pre">Partition</span></code>
to assign nodes by their <code class="docutils literal notranslate"><span class="pre">&quot;2011_PLA_1&quot;</span></code> attribute that we copied from the shapefile. This attributes holds the
assignments of precincts to congressional districts from the 2010 redistricting cycle.</p>
</dd>
<dt class="field-odd">updaters</dt>
<dd class="field-odd"><p>An optional dictionary of “updater” functions. Here we’ve provided an updater named <code class="docutils literal notranslate"><span class="pre">&quot;population&quot;</span></code> that
computes the total population of each district in the partition, based on the <code class="docutils literal notranslate"><span class="pre">&quot;TOT_POP&quot;</span></code> node attribute
from our shapefile, and a <code class="docutils literal notranslate"><span class="pre">cut_edges</span></code> updater. This returns all of the edges in the graph
that cross from one part to another, and is used by <code class="docutils literal notranslate"><span class="pre">propose_random_flip</span></code> to find a random boundary node to
flip.</p>
</dd>
</dl>
<p>With the <code class="docutils literal notranslate"><span class="pre">&quot;population&quot;</span></code> updater configured, we can see the total population in each of our congressional districts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">district</span><span class="p">,</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">initial_partition</span><span class="p">[</span><span class="s2">&quot;population&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;District </span><span class="si">{district}</span><span class="s2">: </span><span class="si">{pop}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(the “f” before the string here marks this as a formatted string, and we use this
to make printing combinations of strings and variable values a bit easier)
This code will print out something like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">District</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">706653</span>
<span class="n">District</span> <span class="mi">10</span><span class="p">:</span> <span class="mi">706992</span>
<span class="n">District</span> <span class="mi">9</span><span class="p">:</span> <span class="mi">702500</span>
<span class="n">District</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">695917</span>
<span class="n">District</span> <span class="mi">15</span><span class="p">:</span> <span class="mi">705549</span>
<span class="n">District</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">705782</span>
<span class="n">District</span> <span class="mi">11</span><span class="p">:</span> <span class="mi">705115</span>
<span class="n">District</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">705689</span>
<span class="n">District</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">705669</span>
<span class="n">District</span> <span class="mi">18</span><span class="p">:</span> <span class="mi">705847</span>
<span class="n">District</span> <span class="mi">12</span><span class="p">:</span> <span class="mi">706232</span>
<span class="n">District</span> <span class="mi">17</span><span class="p">:</span> <span class="mi">699133</span>
<span class="n">District</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">712463</span>
<span class="n">District</span> <span class="mi">16</span><span class="p">:</span> <span class="mi">699557</span>
<span class="n">District</span> <span class="mi">14</span><span class="p">:</span> <span class="mi">705526</span>
<span class="n">District</span> <span class="mi">13</span><span class="p">:</span> <span class="mi">705028</span>
<span class="n">District</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">705689</span>
<span class="n">District</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">705588</span>
</pre></div>
</div>
<p>Notice that <code class="docutils literal notranslate"><span class="pre">partition[&quot;population&quot;]</span></code> is a dictionary mapping the ID of each district to its total
population (that’s why we can call the <code class="docutils literal notranslate"><span class="pre">.items()</span></code> method on it). Most updaters output values in this dictionary format.</p>
<p>And that is it! From here, you can move on to configuring and</p>
</div>
<div class="section" id="running-a-chain">
<h2>Running a chain<a class="headerlink" href="#running-a-chain" title="Permalink to this headline">¶</a></h2>
<p>Now that we have our initial partition, we can configure and run a <code class="xref py py-class docutils literal notranslate"><span class="pre">Markov</span> <span class="pre">chain</span></code>.
Let’s configure a short Markov chain to make sure everything works properly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerrychain</span> <span class="kn">import</span> <span class="n">MarkovChain</span>
<span class="kn">from</span> <span class="nn">gerrychain.constraints</span> <span class="kn">import</span> <span class="n">single_flip_contiguous</span>
<span class="kn">from</span> <span class="nn">gerrychain.proposals</span> <span class="kn">import</span> <span class="n">propose_random_flip</span>
<span class="kn">from</span> <span class="nn">gerrychain.accept</span> <span class="kn">import</span> <span class="n">always_accept</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span>
    <span class="n">proposal</span><span class="o">=</span><span class="n">propose_random_flip</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">single_flip_contiguous</span><span class="p">],</span>
    <span class="n">accept</span><span class="o">=</span><span class="n">always_accept</span><span class="p">,</span>
    <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_partition</span><span class="p">,</span>
    <span class="n">total_steps</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>
</pre></div>
</div>
<p>To configure a chain, we need to specify five objects.</p>
<dl class="field-list simple">
<dt class="field-odd">proposal</dt>
<dd class="field-odd"><p>A function that takes the current state and returns new district assignments (“flips”) for one
or more nodes. This comes in the form of a dictionary mapping one or more node IDs to their new district IDs.
Here we’ve used the <code class="docutils literal notranslate"><span class="pre">propose_random_flip</span></code> proposal, which proposes that a random node on the boundary of one
district be flipped into the neighboring district.</p>
</dd>
<dt class="field-even">constraints</dt>
<dd class="field-even"><p>A list of binary constraints (functions that take a partition and return <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>) that
together define which districting plans. are valid. Here we’ve used just a single constraint, <code class="docutils literal notranslate"><span class="pre">single_flip_contiguous</span></code>,
which checks that each district in  the plan is contiguous. This particular constraint is
optimized for the single-flip proposal function we are using (hence the name). We could add more
constraints to require that districts have nearly-equal population, to impose a bound on the compactness of
the districts according to some score, or to prevent districts from splitting more counties than the original plan.</p>
</dd>
<dt class="field-odd">accept</dt>
<dd class="field-odd"><p>A function that takes a valid proposed state and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> to signal whether
the random walk should indeed move to the proposed state. <code class="docutils literal notranslate"><span class="pre">always_accept</span></code> always accepts valid proposed states.
If you want to implement Metropolis-Hastings or any other more sophisticated acceptance criterion, you can
specify your own custom acceptance function here.</p>
</dd>
<dt class="field-even">initial_state</dt>
<dd class="field-even"><p>The starting partition from which we would like to initiate our random walk.</p>
</dd>
<dt class="field-odd">total_steps</dt>
<dd class="field-odd"><p>The total number of steps to take. Invalid proposals are not counted toward this total, but
rejected (by <code class="docutils literal notranslate"><span class="pre">accept</span></code>) valid states are.</p>
</dd>
</dl>
<p>For more information on the details of our Markov chain implementation, consult
the <code class="xref py py-class docutils literal notranslate"><span class="pre">gerrychain.MarkovChain</span></code> documentation and source code.</p>
<p>The above code configures a Markov chain called <code class="docutils literal notranslate"><span class="pre">chain</span></code>, but does <em>NOT</em> run it yet. We run the chain
by iterating through all of the states using a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop. As an example, let’s iterate through
this chain and print out the population of district 1.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{i}</span><span class="s2"> population for district 1: </span><span class="si">{partition[&#39;population&#39;][1]}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>That’s all: you’ve run a Markov chain!</p>
<div class="note admonition">
<p class="admonition-title">Coding Note</p>
<blockquote>
<div><p>If the step information is important to the analysis that you’re doing, you can
also iterate through the chain slightly more elegantly using the <code class="xref py py-func docutils literal notranslate"><span class="pre">enumerate()</span></code>
function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">partition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chain</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{i}</span><span class="s2"> population for district 1: </span><span class="si">{partition[&#39;population&#39;][1]}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="working-with-elections">
<h3>Working With Elections<a class="headerlink" href="#working-with-elections" title="Permalink to this headline">¶</a></h3>
<p>Of course, <code class="docutils literal notranslate"><span class="pre">gerrychain</span></code> was build for analyzing districting plans, so it seems
like it would be important to be able to analyze election results. We can do this
by adding an <code class="xref py py-class docutils literal notranslate"><span class="pre">Election</span></code> object to our <code class="xref py py-class docutils literal notranslate"><span class="pre">Partition</span></code>
as an updater. To do this, we’ll need to import the <code class="xref py py-class docutils literal notranslate"><span class="pre">Election</span></code> class
and change around our initial partition a bit.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerrychain</span> <span class="kn">import</span> <span class="n">Election</span>

<span class="c1"># Set up the election updater. We give the election a name (&quot;SEN12&quot;) and tell it</span>
<span class="c1"># which column in our shapefile holds the Democratic vote totals (&quot;USS12D&quot;)</span>
<span class="c1"># and which column holds the Republican vote totals (&quot;USS12R&quot;).</span>
<span class="n">election</span> <span class="o">=</span> <span class="n">Election</span><span class="p">(</span><span class="s2">&quot;SEN12&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Dem&quot;</span><span class="p">:</span> <span class="s2">&quot;USS12D&quot;</span><span class="p">,</span> <span class="s2">&quot;Rep&quot;</span><span class="p">:</span> <span class="s2">&quot;USS12R&quot;</span><span class="p">})</span>

<span class="n">initial_partition_2</span> <span class="o">=</span> <span class="n">Partition</span><span class="p">(</span>
    <span class="n">graph</span><span class="p">,</span>
    <span class="n">assignment</span><span class="o">=</span><span class="s2">&quot;2011_PLA_1&quot;</span><span class="p">,</span>
    <span class="n">updaters</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;population&quot;</span><span class="p">:</span> <span class="n">Tally</span><span class="p">(</span><span class="s2">&quot;TOT_POP&quot;</span><span class="p">,</span> <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;population&quot;</span><span class="p">),</span>
        <span class="s2">&quot;cut_edges&quot;</span><span class="p">:</span> <span class="n">cut_edges</span><span class="p">,</span>
        <span class="s2">&quot;SEN12&quot;</span><span class="p">:</span> <span class="n">election</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>You can see that the new election that we have added here is called <code class="docutils literal notranslate"><span class="pre">&quot;SEN12&quot;</span></code> and
we placed in the <code class="docutils literal notranslate"><span class="pre">updaters</span></code> dictionary so that we can track it for every partition
across the Markov chain. Here we have also given the election the name <code class="docutils literal notranslate"><span class="pre">&quot;SEN12&quot;</span></code>
and we told <code class="docutils literal notranslate"><span class="pre">gerrychain</span></code> that the Democratic vote share, which we call <code class="docutils literal notranslate"><span class="pre">&quot;Dem&quot;</span></code>
is stored in the <code class="docutils literal notranslate"><span class="pre">&quot;USS12D&quot;</span></code> attribute of our file. Likewise, we told <cite>gerrychain</cite>
that the Republican vote share, which we call <code class="docutils literal notranslate"><span class="pre">&quot;Rep&quot;</span></code> is stored in the <code class="docutils literal notranslate"><span class="pre">&quot;USS12R&quot;</span></code>
attribute.</p>
<p>Now, we just need to make a new chain, and we can print off some election data!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gerrychain.constraints</span> <span class="kn">import</span> <span class="n">contiguous</span>

<span class="n">chain_2</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span>
    <span class="n">proposal</span><span class="o">=</span><span class="n">propose_random_flip</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">contiguous</span><span class="p">],</span>
    <span class="n">accept</span><span class="o">=</span><span class="n">always_accept</span><span class="p">,</span>
    <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_partition_2</span><span class="p">,</span>
    <span class="n">total_steps</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">partition</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">chain_2</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{i}</span><span class="s2"> Democratic vote share for district 1: &quot;</span>
          <span class="sa">f</span><span class="s2">&quot;{partition[&#39;SEN12&#39;].percents(&#39;Dem&#39;)[1]:0.4f}&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Coding Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">:0.4f</span></code> in the above code is a formatting string that tells Python to print
the preceding number with four decimal places. This is just a formatting string, and is not
specific to <cite>gerrychain</cite>. Also, we have split the string onto different lines
for the sake of readability since python automatically concatenates adjacent strings.</p>
</div>
</div>
<div class="section" id="using-dataframes-to-collect-information">
<h3>Using DataFrames to Collect Information<a class="headerlink" href="#using-dataframes-to-collect-information" title="Permalink to this headline">¶</a></h3>
<p>Printing out data is nice, but it’s not very useful for analysis. Instead, it would
be good if we could collect all of the data from our Markov chain in a list
and then convert it into a <code class="xref py py-mod docutils literal notranslate"><span class="pre">pandas</span></code> <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> for analysis.</p>
<div class="highlight-python notranslate" id="list-comprehension"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span>

<span class="n">d_percents</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">chain_2</span><span class="p">:</span>
    <span class="c1"># We use the sorted function here to ensure that the data is in the same order</span>
    <span class="c1"># as the districts assignments</span>
    <span class="n">d_percents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;SEN12&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">percents</span><span class="p">(</span><span class="s2">&quot;Dem&quot;</span><span class="p">)))</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d_percents</span><span class="p">)</span>
</pre></div>
</div>
<div class="note admonition">
<p class="admonition-title">Coding Note</p>
<p>A more elegant way of achieving the same result is to use a list comprehension
instead of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="n">partition</span><span class="p">[</span><span class="s2">&quot;SEN12&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">percents</span><span class="p">(</span><span class="s2">&quot;Dem&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">partition</span> <span class="ow">in</span> <span class="n">chain_2</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The above code will collect data from a different ensemble than the previous <code class="docutils literal notranslate"><span class="pre">for</span></code> loop.
Each time we iterate through the <code class="docutils literal notranslate"><span class="pre">chain</span></code> object, we run a brand new Markov chain
(using the same configuration that we defined when instantiating <code class="docutils literal notranslate"><span class="pre">chain</span></code>).</p>
</div>
<p>The <a class="reference external" href="https://pandas.pydata.org/">pandas</a> <code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code> object also has many helpful methods for analyzing and plotting
data. For example, we can produce a boxplot of our ensemble’s Democratic vote percentage
vectors, with the initial 2011 districting plan plotted in red, in just a few lines of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">positions</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>From this, you should get something like the following:</p>
<img alt="../_images/example_box_pandas.svg" class="align-center" src="../_images/example_box_pandas.svg" /><p>(Before you over-analyze this data, keep in mind that this is a toy ensemble of just
1000 plans created by single flips.)</p>
</div>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>To see a more elaborate example that uses the ReCom proposal, see <a class="reference internal" href="recom.html"><span class="doc">Running a chain with ReCom</span></a>.</p>
<p>To learn more about the specific components of GerryChain, see the <a class="reference internal" href="../api.html"><span class="doc">API Reference</span></a>.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="recom.html" class="btn btn-neutral float-right" title="Running a chain with ReCom" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Metric Geometry and Gerrymandering Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>